# NNUE Inference

## 1) binary weight format
the c runtime loads a compact binary generated by python export.

```text
magic "UBNNUE1\0"
uint32 input_dim
uint32 hidden_dim
float w1[hidden][input]
float b1[hidden]
float w2[hidden]
float b2[1]
```

## 2) feature map
input uses a 12 by 64 one hot plane and flattens to 768.

```c
int channel = color_offset + (piece_type - 1);
int feature = channel * 64 + square;
```

## 3) forward path
runtime eval is a tiny relu mlp.

```c
hidden[i] = relu(b1[i] + sum_j(w1[i][j] * x[j]));
out = b2 + sum_i(hidden[i] * w2[i]);
```

## references
<https://www.chessprogramming.org/NNUE>
<https://arxiv.org/abs/2402.05087>
